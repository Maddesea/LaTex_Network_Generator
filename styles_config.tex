% styles_config.tex - Visual styling and color schemes
% This module handles all visual styling, colors, and aesthetic configurations

% ============================================================================
% COLOR PALETTE DEFINITIONS
% ============================================================================

% Network asset colors
\definecolor{serverBlue}{RGB}{52, 152, 219}
\definecolor{clientGreen}{RGB}{46, 204, 113}
\definecolor{routerOrange}{RGB}{230, 126, 34}
\definecolor{firewallRed}{RGB}{231, 76, 60}
\definecolor{switchPurple}{RGB}{155, 89, 182}
\definecolor{cloudGray}{RGB}{149, 165, 166}

% Threat indicator colors
\definecolor{threatCritical}{RGB}{192, 57, 43}
\definecolor{threatHigh}{RGB}{211, 84, 0}
\definecolor{threatMedium}{RGB}{243, 156, 18}
\definecolor{threatLow}{RGB}{241, 196, 15}
\definecolor{threatInfo}{RGB}{52, 152, 219}

% Connection colors
\definecolor{connNormal}{RGB}{127, 140, 141}
\definecolor{connEncrypted}{RGB}{39, 174, 96}
\definecolor{connSuspicious}{RGB}{230, 126, 34}
\definecolor{connMalicious}{RGB}{192, 57, 43}

% Background colors
\definecolor{bgLight}{RGB}{236, 240, 241}
\definecolor{bgDark}{RGB}{44, 62, 80}

% ============================================================================
% COLOR SCHEME SYSTEM
% ============================================================================

% Current color scheme (default: standard)
\newcommand{\currentColorScheme}{standard}
\newcommand{\currentTheme}{light}

% Command to set theme (light/dark)
\newcommand{\setTheme}[1]{
    \renewcommand{\currentTheme}{#1}
    \ifthenelse{\equal{#1}{dark}}{
        % Apply dark theme colors
        \colorlet{bgPrimary}{bgDark}
        \colorlet{textPrimary}{white}
        \colorlet{textSecondary}{white!80}
    }{
        % Apply light theme colors
        \colorlet{bgPrimary}{bgLight}
        \colorlet{textPrimary}{black!90}
        \colorlet{textSecondary}{black!70}
    }
}

% Initialize with light theme
\setTheme{light}

% Command to load color schemes
\newcommand{\loadColorScheme}[1]{
    \renewcommand{\currentColorScheme}{#1}

    % Standard color scheme (default)
    \ifthenelse{\equal{#1}{standard}}{
        \definecolor{serverBlue}{RGB}{52, 152, 219}
        \definecolor{clientGreen}{RGB}{46, 204, 113}
        \definecolor{routerOrange}{RGB}{230, 126, 34}
        \definecolor{firewallRed}{RGB}{231, 76, 60}
        \definecolor{switchPurple}{RGB}{155, 89, 182}
        \definecolor{cloudGray}{RGB}{149, 165, 166}
        \definecolor{threatCritical}{RGB}{192, 57, 43}
        \definecolor{threatHigh}{RGB}{211, 84, 0}
        \definecolor{threatMedium}{RGB}{243, 156, 18}
        \definecolor{threatLow}{RGB}{241, 196, 15}
        \definecolor{threatInfo}{RGB}{52, 152, 219}
    }{}

    % Dark color scheme
    \ifthenelse{\equal{#1}{dark}}{
        \definecolor{serverBlue}{RGB}{100, 181, 246}
        \definecolor{clientGreen}{RGB}{129, 199, 132}
        \definecolor{routerOrange}{RGB}{255, 167, 38}
        \definecolor{firewallRed}{RGB}{239, 83, 80}
        \definecolor{switchPurple}{RGB}{186, 104, 200}
        \definecolor{cloudGray}{RGB}{189, 189, 189}
        \definecolor{threatCritical}{RGB}{244, 67, 54}
        \definecolor{threatHigh}{RGB}{255, 112, 67}
        \definecolor{threatMedium}{RGB}{255, 193, 7}
        \definecolor{threatLow}{RGB}{255, 235, 59}
        \definecolor{threatInfo}{RGB}{100, 181, 246}
        \setTheme{dark}
    }{}

    % Colorblind-friendly (deuteranopia/protanopia safe)
    \ifthenelse{\equal{#1}{colorblind}}{
        \definecolor{serverBlue}{RGB}{0, 114, 178}      % Blue
        \definecolor{clientGreen}{RGB}{0, 158, 115}     % Bluish green
        \definecolor{routerOrange}{RGB}{213, 94, 0}     % Vermillion
        \definecolor{firewallRed}{RGB}{204, 121, 167}   % Reddish purple
        \definecolor{switchPurple}{RGB}{86, 180, 233}   % Sky blue
        \definecolor{cloudGray}{RGB}{127, 127, 127}     % Gray
        \definecolor{threatCritical}{RGB}{213, 94, 0}   % Vermillion
        \definecolor{threatHigh}{RGB}{230, 159, 0}      % Orange
        \definecolor{threatMedium}{RGB}{240, 228, 66}   % Yellow
        \definecolor{threatLow}{RGB}{0, 158, 115}       % Bluish green
        \definecolor{threatInfo}{RGB}{0, 114, 178}      % Blue
    }{}

    % Monochrome (grayscale)
    \ifthenelse{\equal{#1}{monochrome}}{
        \definecolor{serverBlue}{RGB}{60, 60, 60}
        \definecolor{clientGreen}{RGB}{100, 100, 100}
        \definecolor{routerOrange}{RGB}{140, 140, 140}
        \definecolor{firewallRed}{RGB}{40, 40, 40}
        \definecolor{switchPurple}{RGB}{120, 120, 120}
        \definecolor{cloudGray}{RGB}{180, 180, 180}
        \definecolor{threatCritical}{RGB}{30, 30, 30}
        \definecolor{threatHigh}{RGB}{70, 70, 70}
        \definecolor{threatMedium}{RGB}{110, 110, 110}
        \definecolor{threatLow}{RGB}{150, 150, 150}
        \definecolor{threatInfo}{RGB}{190, 190, 190}
    }{}

    % High contrast (accessibility)
    \ifthenelse{\equal{#1}{high-contrast}}{
        \definecolor{serverBlue}{RGB}{0, 0, 255}
        \definecolor{clientGreen}{RGB}{0, 255, 0}
        \definecolor{routerOrange}{RGB}{255, 165, 0}
        \definecolor{firewallRed}{RGB}{255, 0, 0}
        \definecolor{switchPurple}{RGB}{128, 0, 128}
        \definecolor{cloudGray}{RGB}{128, 128, 128}
        \definecolor{threatCritical}{RGB}{139, 0, 0}
        \definecolor{threatHigh}{RGB}{255, 69, 0}
        \definecolor{threatMedium}{RGB}{255, 215, 0}
        \definecolor{threatLow}{RGB}{255, 255, 0}
        \definecolor{threatInfo}{RGB}{0, 191, 255}
    }{}

    % Tritanopia-safe color scheme
    \ifthenelse{\equal{#1}{tritanopia}}{
        \definecolor{serverBlue}{RGB}{227, 114, 114}    % Red
        \definecolor{clientGreen}{RGB}{255, 187, 120}   % Orange
        \definecolor{routerOrange}{RGB}{255, 204, 229}  % Pink
        \definecolor{firewallRed}{RGB}{179, 88, 6}      % Dark orange
        \definecolor{switchPurple}{RGB}{136, 204, 238}  % Sky blue
        \definecolor{cloudGray}{RGB}{127, 127, 127}     % Gray
        \definecolor{threatCritical}{RGB}{179, 88, 6}
        \definecolor{threatHigh}{RGB}{227, 114, 114}
        \definecolor{threatMedium}{RGB}{255, 187, 120}
        \definecolor{threatLow}{RGB}{255, 204, 229}
        \definecolor{threatInfo}{RGB}{136, 204, 238}
    }{}
}

% ============================================================================
% NODE STYLES
% ============================================================================

\tikzset{
    % Base node style
    base node/.style={
        draw,
        thick,
        minimum width=2.5cm,
        minimum height=1.5cm,
        align=center,
        font=\small\sffamily,
        blur shadow={shadow blur steps=5, shadow xshift=0pt, shadow yshift=-2pt}
    },
    
    % Server style
    server/.style={
        base node,
        rectangle,
        rounded corners=3pt,
        fill=serverBlue!20,
        draw=serverBlue!80,
        line width=1.5pt
    },
    
    % Client/Workstation style
    client/.style={
        base node,
        rectangle,
        rounded corners=2pt,
        fill=clientGreen!15,
        draw=clientGreen!70,
        line width=1pt
    },
    
    % Router style
    router/.style={
        base node,
        trapezium,
        trapezium left angle=70,
        trapezium right angle=110,
        fill=routerOrange!20,
        draw=routerOrange!80,
        line width=1.5pt
    },
    
    % Firewall style
    firewall/.style={
        base node,
        rectangle,
        fill=firewallRed!15,
        draw=firewallRed!80,
        line width=2pt,
        pattern=north east lines,
        pattern color=firewallRed!30
    },
    
    % Switch style
    switch/.style={
        base node,
        rectangle,
        rounded corners=1pt,
        fill=switchPurple!15,
        draw=switchPurple!70,
        minimum height=1cm
    },
    
    % Cloud/Internet style
    cloud/.style={
        base node,
        shape=cloud,
        cloud puffs=10,
        cloud puff arc=120,
        aspect=2,
        fill=cloudGray!20,
        draw=cloudGray!70
    },
    
    % Attacker node style
    attacker/.style={
        base node,
        shape=star,
        star points=5,
        fill=threatCritical!30,
        draw=threatCritical!90,
        line width=2pt,
        minimum width=2cm,
        minimum height=2cm
    },

    % ========================================================================
    % GRADIENT VARIANTS (Premium Look)
    % ========================================================================

    % Server with gradient
    server premium/.style={
        base node,
        rectangle,
        rounded corners=3pt,
        server gradient,
        draw=serverBlue!80,
        line width=1.5pt
    },

    % Client with gradient
    client premium/.style={
        base node,
        rectangle,
        rounded corners=2pt,
        client gradient,
        draw=clientGreen!70,
        line width=1pt
    },

    % Router with gradient
    router premium/.style={
        base node,
        trapezium,
        trapezium left angle=70,
        trapezium right angle=110,
        router gradient,
        draw=routerOrange!80,
        line width=1.5pt
    },

    % Firewall with gradient
    firewall premium/.style={
        base node,
        rectangle,
        firewall gradient,
        draw=firewallRed!80,
        line width=2pt,
        pattern=north east lines,
        pattern color=firewallRed!30
    },

    % Switch with gradient
    switch premium/.style={
        base node,
        rectangle,
        rounded corners=1pt,
        switch gradient,
        draw=switchPurple!70,
        minimum height=1cm
    },

    % Cloud with gradient
    cloud premium/.style={
        base node,
        shape=cloud,
        cloud puffs=10,
        cloud puff arc=120,
        aspect=2,
        cloud gradient,
        draw=cloudGray!70
    },

    % ========================================================================
    % COLORBLIND-SAFE VARIANTS (With Patterns)
    % ========================================================================

    % Server with pattern for colorblind users
    server colorblind/.style={
        base node,
        rectangle,
        rounded corners=3pt,
        fill=serverBlue!20,
        draw=serverBlue!80,
        line width=1.5pt,
        postaction={pattern=dots, pattern color=serverBlue!40}
    },

    % Client with pattern
    client colorblind/.style={
        base node,
        rectangle,
        rounded corners=2pt,
        fill=clientGreen!15,
        draw=clientGreen!70,
        line width=1pt,
        postaction={pattern=horizontal lines, pattern color=clientGreen!40}
    },

    % Router with pattern
    router colorblind/.style={
        base node,
        trapezium,
        trapezium left angle=70,
        trapezium right angle=110,
        fill=routerOrange!20,
        draw=routerOrange!80,
        line width=1.5pt,
        postaction={pattern=vertical lines, pattern color=routerOrange!40}
    },

    % Firewall with enhanced pattern
    firewall colorblind/.style={
        base node,
        rectangle,
        fill=firewallRed!15,
        draw=firewallRed!80,
        line width=2pt,
        pattern=crosshatch,
        pattern color=firewallRed!40
    },

    % Switch with pattern
    switch colorblind/.style={
        base node,
        rectangle,
        rounded corners=1pt,
        fill=switchPurple!15,
        draw=switchPurple!70,
        minimum height=1cm,
        postaction={pattern=grid, pattern color=switchPurple!40}
    }
}

% ============================================================================
% GRADIENT DEFINITIONS FOR PREMIUM LOOK
% ============================================================================

% Vertical gradient shadings
\tikzset{
    % Server gradient (blue)
    server gradient/.style={
        top color=serverBlue!40,
        bottom color=serverBlue!10,
        middle color=serverBlue!25
    },

    % Client gradient (green)
    client gradient/.style={
        top color=clientGreen!35,
        bottom color=clientGreen!5,
        middle color=clientGreen!20
    },

    % Router gradient (orange)
    router gradient/.style={
        top color=routerOrange!40,
        bottom color=routerOrange!10,
        middle color=routerOrange!25
    },

    % Firewall gradient (red)
    firewall gradient/.style={
        top color=firewallRed!30,
        bottom color=firewallRed!5,
        middle color=firewallRed!17
    },

    % Switch gradient (purple)
    switch gradient/.style={
        top color=switchPurple!35,
        bottom color=switchPurple!5,
        middle color=switchPurple!20
    },

    % Cloud gradient (gray)
    cloud gradient/.style={
        top color=cloudGray!40,
        bottom color=cloudGray!10,
        middle color=cloudGray!25
    },

    % Radial gradient for emphasis (can be applied to any node)
    radial gradient/.style={
        inner color=#1!20,
        outer color=#1!5
    },

    % Metallic/glossy effect
    metallic/.style={
        top color=white,
        bottom color=#1!30,
        middle color=#1!60,
        shading angle=135
    }
}

% ============================================================================
% BADGE AND LABEL SUPPORT FOR OS/STATUS INDICATORS
% ============================================================================

% Badge styles
\tikzset{
    % Base badge style
    base badge/.style={
        circle,
        minimum size=0.6cm,
        font=\tiny\bfseries,
        inner sep=1pt
    },

    % OS badges
    windows badge/.style={
        base badge,
        fill=blue!70,
        text=white,
        draw=blue!90,
        line width=0.5pt
    },

    linux badge/.style={
        base badge,
        fill=orange!70,
        text=white,
        draw=orange!90,
        line width=0.5pt
    },

    macos badge/.style={
        base badge,
        fill=gray!70,
        text=white,
        draw=gray!90,
        line width=0.5pt
    },

    % Status badges
    online badge/.style={
        base badge,
        fill=green!60,
        text=white,
        draw=green!80,
        line width=0.5pt
    },

    offline badge/.style={
        base badge,
        fill=gray!60,
        text=white,
        draw=gray!80,
        line width=0.5pt
    },

    warning badge/.style={
        base badge,
        fill=yellow!70,
        text=black,
        draw=orange!80,
        line width=0.5pt
    },

    critical badge/.style={
        base badge,
        fill=red!70,
        text=white,
        draw=red!90,
        line width=0.5pt
    },

    % Corner badge positioning helper
    badge north east/.style={
        anchor=south west,
        xshift=0.1cm,
        yshift=0.1cm
    },

    badge north west/.style={
        anchor=south east,
        xshift=-0.1cm,
        yshift=0.1cm
    },

    badge south east/.style={
        anchor=north west,
        xshift=0.1cm,
        yshift=-0.1cm
    },

    badge south west/.style={
        anchor=north east,
        xshift=-0.1cm,
        yshift=-0.1cm
    }
}

% Command to add a badge to a node
% Usage: \nodeBadge{node-name}{badge-style}{position}{text}
\newcommand{\nodeBadge}[4]{
    \node[#2, badge #3] at (#1.#3) {#4};
}

% ============================================================================
% ICON/IMAGE SUPPORT INSIDE NODES
% ============================================================================

% Icon placeholder styles (can be replaced with actual icons/images)
\tikzset{
    % Server icon style
    server icon/.style={
        rectangle,
        minimum width=0.8cm,
        minimum height=0.6cm,
        fill=serverBlue!60,
        draw=serverBlue!90,
        line width=0.5pt,
        rounded corners=1pt
    },

    % Laptop icon style
    laptop icon/.style={
        rectangle,
        minimum width=0.8cm,
        minimum height=0.5cm,
        fill=clientGreen!60,
        draw=clientGreen!90,
        line width=0.5pt,
        rounded corners=2pt,
        append after command={
            \pgfextra{
                \draw[clientGreen!90, line width=0.5pt]
                    (\tikzlastnode.south west) -- ++(0,-0.05) -- ++(\tikzlastnode.width,0);
            }
        }
    },

    % Phone/mobile icon style
    phone icon/.style={
        rectangle,
        minimum width=0.4cm,
        minimum height=0.7cm,
        fill=clientGreen!60,
        draw=clientGreen!90,
        line width=0.5pt,
        rounded corners=2pt
    },

    % Router icon style
    router icon/.style={
        rectangle,
        minimum width=0.8cm,
        minimum height=0.4cm,
        fill=routerOrange!60,
        draw=routerOrange!90,
        line width=0.5pt,
        append after command={
            \pgfextra{
                \draw[routerOrange!90] (\tikzlastnode.north) -- ++(0,0.15) circle(0.05);
                \draw[routerOrange!90] (\tikzlastnode.north) ++(0.2,0) -- ++(0,0.15) circle(0.05);
                \draw[routerOrange!90] (\tikzlastnode.north) ++(-0.2,0) -- ++(0,0.15) circle(0.05);
            }
        }
    },

    % Database icon style
    database icon/.style={
        cylinder,
        shape border rotate=90,
        minimum width=0.6cm,
        minimum height=0.8cm,
        fill=serverBlue!60,
        draw=serverBlue!90,
        line width=0.5pt,
        aspect=0.3
    }
}

% Command to add an icon to a node
% Usage: \nodeIcon{x}{y}{icon-style}{optional-label}
\newcommand{\nodeIcon}[4][]{
    \node[#3] at (#2) {#1};
    \ifthenelse{\equal{#4}{}}{}{
        \node[below=0.1cm of #2, font=\tiny] {#4};
    }
}

% ============================================================================
% CONNECTION STYLES
% ============================================================================

\tikzset{
    % Normal connection
    normal conn/.style={
        draw=connNormal,
        line width=1pt,
        -{Stealth[length=3mm]}
    },
    
    % Encrypted connection
    encrypted conn/.style={
        draw=connEncrypted,
        line width=1.5pt,
        -{Stealth[length=3mm]},
        postaction={
            decorate,
            decoration={
                markings,
                mark=between positions 0.1 and 1 step 0.1 with {
                    \node[fill=connEncrypted!30, circle, inner sep=1pt] {};
                }
            }
        }
    },
    
    % Suspicious connection
    suspicious conn/.style={
        draw=connSuspicious,
        line width=1.5pt,
        dashed,
        dash pattern=on 4pt off 2pt,
        -{Stealth[length=3mm]}
    },
    
    % Malicious/attack connection
    attack conn/.style={
        draw=connMalicious,
        line width=2pt,
        -{Stealth[length=4mm]},
        postaction={
            draw=connMalicious!30,
            line width=3pt,
            shorten >=2pt,
            shorten <=2pt
        }
    },
    
    % Bidirectional connection
    bidirectional/.style={
        {Stealth[length=3mm]}-{Stealth[length=3mm]}
    }
}

% TODO: Advanced connection rendering
% - Add bandwidth indicators (line thickness based on traffic volume)
% - Implement animated flow direction indicators
% - Add connection labels for protocol/port information
% - Create curved/bezier connection options for complex topologies
% - Add connection aggregation for high-density diagrams

% ============================================================================
% TEXT LABEL STYLES
% ============================================================================

\tikzset{
    % IP address label
    ip label/.style={
        font=\scriptsize\ttfamily,
        text=black!70,
        fill=white,
        inner sep=2pt,
        rounded corners=1pt
    },
    
    % Asset name label
    asset label/.style={
        font=\small\bfseries\sffamily,
        text=black!90
    },
    
    % Threat level label
    threat label/.style={
        font=\tiny\sffamily\bfseries,
        text=white,
        fill=threatCritical,
        inner sep=3pt,
        rounded corners=2pt
    },
    
    % Port/service label
    port label/.style={
        font=\tiny\ttfamily,
        text=black!60,
        fill=white,
        inner sep=1pt
    }
}

% TODO: Label enhancements
% - Auto-positioning to avoid overlap
% - Automatic truncation for long labels
% - Hover-style detailed info boxes
% - Multi-line label support with proper formatting

% ============================================================================
% LEGEND AND METADATA STYLES
% ============================================================================

\tikzset{
    legend box/.style={
        rectangle,
        draw=black!50,
        fill=white,
        inner sep=5pt,
        rounded corners=2pt,
        blur shadow={shadow blur steps=3}
    }
}

% TODO: Legend improvements
% - Auto-generate legend based on diagram content
% - Collapsible/expandable legend sections
% - Position customization (corner placement options)
% - Size scaling based on diagram complexity

% ============================================================================
% PAGE SIZE CONFIGURATIONS
% ============================================================================

\newcommand{\setPageSize}[1]{
    \ifthenelse{\equal{#1}{a4}}{
        \renewcommand{\diagramScale}{1.0}
    }{
    \ifthenelse{\equal{#1}{a3}}{
        \renewcommand{\diagramScale}{1.4}
    }{
    \ifthenelse{\equal{#1}{a2}}{
        \renewcommand{\diagramScale}{2.0}
    }{
    \ifthenelse{\equal{#1}{a1}}{
        \renewcommand{\diagramScale}{2.8}
    }{
    \ifthenelse{\equal{#1}{a0}}{
        \renewcommand{\diagramScale}{4.0}
    }{
    \ifthenelse{\equal{#1}{letter}}{
        \renewcommand{\diagramScale}{1.0}
    }{
        \renewcommand{\diagramScale}{1.0}
    }}}}}}
}

% TODO: Page size optimization
% - Auto-scaling based on node count
% - Maintain aspect ratio across different sizes
% - Add support for custom dimensions
% - Portrait vs landscape orientation support
% - Multi-page diagram support for very large networks

% ============================================================================
% BEAMER ANIMATION SUPPORT
% ============================================================================

% Check if beamer is loaded
\newif\ifbeamer
\@ifclassloaded{beamer}{\beamertrue}{\beamerfalse}

% Pulse effect for highlighting nodes (works in Beamer)
\tikzset{
    pulse/.style={
        animate={
            myself:={
                0s={opacity=1, scale=1},
                0.5s={opacity=0.7, scale=1.05},
                1s={opacity=1, scale=1},
                repeat
            }
        }
    },

    % Fade in effect for progressive disclosure
    fade in/.style={
        opacity=0,
        animate={
            myself:={
                0s={opacity=0},
                0.3s={opacity=1}
            }
        }
    },

    % Highlight effect (border pulse)
    highlight pulse/.style={
        animate={
            myself:={
                line width/.list={1.5pt, 3pt, 1.5pt},
                begin on=click,
                duration=0.5s,
                repeat=3
            }
        }
    }
}

% Overlay-aware node creation for Beamer presentations
\newcommand{\createOverlayNode}[5]{
    % #1 = overlay spec, #2 = style, #3 = position, #4 = name, #5 = text
    \only<#1>{\node[#2] (#4) at #3 {#5};}
}

% Progressive reveal for connections
\newcommand{\revealConnection}[4]{
    % #1 = overlay spec, #2 = style, #3 = from, #4 = to
    \only<#1>{\draw[#2] (#3) -- (#4);}
}

% ============================================================================
% MULTI-PART NODES FOR DETAILED INFORMATION
% ============================================================================

\tikzset{
    % Multi-part node base style
    info node/.style={
        rectangle split,
        rectangle split parts=3,
        draw,
        rounded corners=2pt,
        font=\small\sffamily,
        text width=3cm,
        align=center
    },

    % Server with detailed info (hostname | IP | ports)
    detailed server/.style={
        info node,
        rectangle split part fill={serverBlue!30, serverBlue!15, serverBlue!10},
        draw=serverBlue!80,
        line width=1pt
    },

    % Client with system info
    detailed client/.style={
        info node,
        rectangle split part fill={clientGreen!25, clientGreen!12, clientGreen!8},
        draw=clientGreen!70,
        line width=1pt
    },

    % Node with status bars (CPU, Memory, Disk)
    status node/.style={
        info node,
        rectangle split parts=4,
        minimum width=3.5cm
    }
}

% Command to create a detailed server node
% Usage: \detailedServer{name}{x}{y}{hostname}{IP}{ports}
\newcommand{\detailedServer}[6]{
    \node[detailed server] (#1) at (#2,#3) {
        \textbf{#4}
        \nodepart{two}\texttt{#5}
        \nodepart{three}\scriptsize Ports: #6
    };
}

% Command to create a detailed client node
% Usage: \detailedClient{name}{x}{y}{hostname}{IP}{OS}
\newcommand{\detailedClient}[6]{
    \node[detailed client] (#1) at (#2,#3) {
        \textbf{#4}
        \nodepart{two}\texttt{#5}
        \nodepart{three}\scriptsize #6
    };
}

% ============================================================================
% ADVANCED VISUAL EFFECTS
% ============================================================================

\tikzset{
    % Glow effect for emphasis
    glow/.style={
        blur shadow={
            shadow blur steps=15,
            shadow xshift=0pt,
            shadow yshift=0pt,
            shadow blur radius=8pt,
            shadow opacity=60
        }
    },

    % Strong glow for critical alerts
    strong glow/.style={
        blur shadow={
            shadow blur steps=20,
            shadow xshift=0pt,
            shadow yshift=0pt,
            shadow blur radius=12pt,
            shadow opacity=80,
            shadow color=#1
        }
    },

    % Neon effect
    neon/.style={
        line width=2pt,
        draw=#1!90,
        blur shadow={
            shadow blur steps=15,
            shadow xshift=0pt,
            shadow yshift=0pt,
            shadow blur radius=6pt,
            shadow color=#1,
            shadow opacity=70
        }
    },

    % Double border for emphasis
    double border/.style={
        draw=#1!80,
        line width=1.5pt,
        postaction={
            draw=#1!40,
            line width=3pt,
            shorten >=1pt,
            shorten <=1pt
        }
    },

    % Dashed border with shadow
    dashed shadow/.style={
        draw=#1!70,
        line width=1.5pt,
        dashed,
        dash pattern=on 4pt off 3pt,
        blur shadow={shadow blur steps=5}
    }
}

% ============================================================================
% ADDITIONAL BADGE TYPES
% ============================================================================

\tikzset{
    % Security level badges
    security high/.style={
        base badge,
        fill=green!70,
        text=white,
        draw=green!90,
        line width=0.5pt
    },

    security medium/.style={
        base badge,
        fill=yellow!70,
        text=black,
        draw=yellow!90,
        line width=0.5pt
    },

    security low/.style={
        base badge,
        fill=red!70,
        text=white,
        draw=red!90,
        line width=0.5pt
    },

    % Service type badges
    web service badge/.style={
        base badge,
        rectangle,
        rounded corners=2pt,
        fill=blue!60,
        text=white,
        font=\tiny\ttfamily
    },

    database service badge/.style={
        base badge,
        rectangle,
        rounded corners=2pt,
        fill=purple!60,
        text=white,
        font=\tiny\ttfamily
    },

    api service badge/.style={
        base badge,
        rectangle,
        rounded corners=2pt,
        fill=orange!60,
        text=white,
        font=\tiny\ttfamily
    },

    ssh service badge/.style={
        base badge,
        rectangle,
        rounded corners=2pt,
        fill=gray!60,
        text=white,
        font=\tiny\ttfamily
    },

    % CVE severity badges
    cve critical/.style={
        rectangle,
        rounded corners=2pt,
        fill=red!80,
        text=white,
        font=\tiny\bfseries,
        inner sep=2pt,
        minimum width=1.2cm
    },

    cve high/.style={
        rectangle,
        rounded corners=2pt,
        fill=orange!80,
        text=white,
        font=\tiny\bfseries,
        inner sep=2pt,
        minimum width=1.2cm
    },

    cve medium/.style={
        rectangle,
        rounded corners=2pt,
        fill=yellow!80,
        text=black,
        font=\tiny\bfseries,
        inner sep=2pt,
        minimum width=1.2cm
    },

    cve low/.style={
        rectangle,
        rounded corners=2pt,
        fill=green!60,
        text=white,
        font=\tiny\bfseries,
        inner sep=2pt,
        minimum width=1.2cm
    }
}

% ============================================================================
% HELPER MACROS FOR EASIER USAGE
% ============================================================================

% Quick node creation with automatic styling
% Usage: \quickServer{name}{x}{y}{label}
\newcommand{\quickServer}[4]{
    \node[server premium, glow] (#1) at (#2,#3) {#4};
}

\newcommand{\quickClient}[4]{
    \node[client premium, glow] (#1) at (#2,#3) {#4};
}

\newcommand{\quickRouter}[4]{
    \node[router premium, glow] (#1) at (#2,#3) {#4};
}

\newcommand{\quickFirewall}[4]{
    \node[firewall premium, glow] (#1) at (#2,#3) {#4};
}

% Add multiple badges at once
% Usage: \addBadges{node-name}{os-badge}{status-badge}
\newcommand{\addBadges}[3]{
    \nodeBadge{#1}{#2}{north east}{OS}
    \nodeBadge{#1}{#3}{north west}{\checkmark}
}

% Add CVE badge to node
% Usage: \addCVE{node-name}{CVE-ID}{severity}{score}
\newcommand{\addCVE}[4]{
    \node[cve #3, below=0.2cm of #1] {#2: #4};
}

% Add service badge
% Usage: \addService{node-name}{service-type}{port}
\newcommand{\addService}[3]{
    \node[#2 service badge, above=0.1cm of #1] {#3};
}

% ============================================================================
% STYLE PRESET SYSTEM
% ============================================================================

% Preset: Corporate (professional, conservative)
\newcommand{\loadCorporatePreset}{
    \loadColorScheme{monochrome}
    \tikzset{
        every node/.append style={font=\sffamily},
        server/.append style={server premium},
        client/.append style={client premium},
        router/.append style={router premium}
    }
}

% Preset: Security Report (high contrast, clear threats)
\newcommand{\loadSecurityPreset}{
    \loadColorScheme{high-contrast}
    \tikzset{
        every node/.append style={double border=black},
        attacker/.append style={strong glow=red}
    }
}

% Preset: Presentation (high visibility, animations ready)
\newcommand{\loadPresentationPreset}{
    \loadColorScheme{standard}
    \tikzset{
        every node/.append style={glow},
        server/.append style={server premium},
        client/.append style={client premium}
    }
}

% Preset: Colorblind Accessible
\newcommand{\loadAccessiblePreset}{
    \loadColorScheme{colorblind}
    \tikzset{
        server/.append style={server colorblind},
        client/.append style={client colorblind},
        router/.append style={router colorblind},
        firewall/.append style={firewall colorblind}
    }
}

% Preset: Dark Mode
\newcommand{\loadDarkPreset}{
    \loadColorScheme{dark}
    \setTheme{dark}
    \tikzset{
        every node/.append style={text=white},
        server/.append style={server premium, neon=serverBlue},
        client/.append style={client premium, neon=clientGreen}
    }
}

% ============================================================================
% STYLE EXPORT/IMPORT HELPERS
% ============================================================================

% Save current color scheme to macro
\newcommand{\exportCurrentScheme}[1]{
    \edef#1{\currentColorScheme}
}

% Restore saved color scheme
\newcommand{\importScheme}[1]{
    \loadColorScheme{#1}
}

% Create custom color scheme from current colors
\newcommand{\saveAsCustomScheme}[1]{
    % This creates a snapshot of current colors as a custom scheme
    % Users can then reload it with \loadColorScheme{#1}
    \expandafter\newcommand\csname loadColorScheme#1\endcsname{
        % Colors will be preserved at definition time
        \colorlet{serverBlue-#1}{serverBlue}
        \colorlet{clientGreen-#1}{clientGreen}
        \colorlet{routerOrange-#1}{routerOrange}
    }
}

% ============================================================================
% UTILITY COMMANDS
% ============================================================================

% Quick color scheme comparison (for documentation)
\newcommand{\showColorSwatch}[2]{
    % #1 = color name, #2 = color definition
    \tikz{\node[fill=#2, minimum width=1cm, minimum height=0.5cm, draw=black] {};}
    \texttt{#1}
}

% Display all available color schemes
\newcommand{\listColorSchemes}{
    Available schemes: standard, dark, colorblind, tritanopia, monochrome, high-contrast
}

% Display all available presets
\newcommand{\listPresets}{
    Available presets: Corporate, Security, Presentation, Accessible, Dark
}

% ============================================================================
% ENHANCED CONNECTION STYLES WITH BANDWIDTH INDICATORS
% ============================================================================

\tikzset{
    % Bandwidth-aware connections (line thickness indicates capacity)
    bandwidth low/.style={
        line width=0.5pt,
        draw=connNormal!70
    },

    bandwidth medium/.style={
        line width=1.5pt,
        draw=connNormal
    },

    bandwidth high/.style={
        line width=3pt,
        draw=connNormal!80
    },

    bandwidth ultra/.style={
        line width=5pt,
        draw=blue!60
    },

    % Connection with congestion indicator (red/yellow/green)
    congestion critical/.style={
        line width=2pt,
        draw=red!70,
        postaction={
            draw=red!30,
            line width=4pt,
            shorten >=2pt,
            shorten <=2pt
        }
    },

    congestion warning/.style={
        line width=2pt,
        draw=yellow!70,
        postaction={
            draw=yellow!30,
            line width=4pt,
            shorten >=2pt,
            shorten <=2pt
        }
    },

    congestion normal/.style={
        line width=2pt,
        draw=green!70,
        postaction={
            draw=green!30,
            line width=4pt,
            shorten >=2pt,
            shorten <=2pt
        }
    },

    % VPN tunnel style (thick dashed with encryption indicators)
    vpn tunnel/.style={
        line width=3pt,
        draw=green!60,
        dashed,
        dash pattern=on 6pt off 3pt,
        postaction={
            decorate,
            decoration={
                markings,
                mark=between positions 0.1 and 0.9 step 0.15 with {
                    \node[fill=green!40, circle, inner sep=1.5pt] {};
                }
            }
        }
    },

    % Fiber optic style (light beam effect)
    fiber optic/.style={
        line width=2pt,
        draw=cyan!80,
        postaction={
            draw=cyan!30,
            line width=4pt,
            shorten >=1pt,
            shorten <=1pt
        },
        postaction={
            draw=white,
            line width=1pt
        }
    },

    % Wireless connection (wave pattern)
    wireless/.style={
        line width=1.5pt,
        draw=purple!60,
        decorate,
        decoration={
            snake,
            amplitude=1mm,
            segment length=5mm
        }
    },

    % Satellite link (dashed with satellite markers)
    satellite/.style={
        line width=1.5pt,
        draw=orange!70,
        dashed,
        dash pattern=on 8pt off 4pt,
        postaction={
            decorate,
            decoration={
                markings,
                mark=at position 0.5 with {
                    \node[fill=orange!60, star, star points=5, minimum size=4pt] {};
                }
            }
        }
    },

    % Load balanced connection (multiple parallel lines)
    load balanced/.style={
        double distance=2pt,
        draw=blue!70,
        line width=1pt,
        postaction={
            draw=blue!30,
            line width=3pt,
            shorten >=2pt,
            shorten <=2pt
        }
    }
}

% Command to draw labeled connection with auto-positioning
% Usage: \labeledConnection{from}{to}{style}{label}
\newcommand{\labeledConnection}[4]{
    \draw[#3] (#1) -- node[midway, auto, fill=white, inner sep=2pt, font=\tiny] {#4} (#2);
}

% Command to draw bandwidth connection with percentage
% Usage: \bandwidthConnection{from}{to}{utilization}{label}
\newcommand{\bandwidthConnection}[4]{
    \pgfmathparse{#3 < 50 ? 1 : (#3 < 80 ? 2 : 3)}
    \let\congestlevel\pgfmathresult
    \ifnum\congestlevel=1
        \draw[congestion normal] (#1) -- node[midway, auto, fill=white, inner sep=2pt, font=\tiny] {#4: #3\%} (#2);
    \fi
    \ifnum\congestlevel=2
        \draw[congestion warning] (#1) -- node[midway, auto, fill=white, inner sep=2pt, font=\tiny] {#4: #3\%} (#2);
    \fi
    \ifnum\congestlevel=3
        \draw[congestion critical] (#1) -- node[midway, auto, fill=white, inner sep=2pt, font=\tiny] {#4: #3\%} (#2);
    \fi
}

% ============================================================================
% ADDITIONAL VISUAL EFFECTS
% ============================================================================

\tikzset{
    % Flashing alert effect (for critical nodes)
    flash alert/.style={
        fill=red!70,
        draw=red!90,
        line width=3pt,
        blur shadow={
            shadow blur steps=20,
            shadow xshift=0pt,
            shadow yshift=0pt,
            shadow blur radius=15pt,
            shadow color=red,
            shadow opacity=90
        }
    },

    % Shimmer effect (subtle glow variation)
    shimmer/.style={
        blur shadow={
            shadow blur steps=10,
            shadow xshift=0pt,
            shadow yshift=0pt,
            shadow blur radius=5pt,
            shadow color=#1,
            shadow opacity=50
        }
    },

    % Danger zone style
    danger zone/.style={
        fill=red!10,
        draw=red!60,
        line width=2pt,
        dashed,
        dash pattern=on 5pt off 5pt,
        blur shadow={shadow blur steps=5}
    },

    % Safe zone style
    safe zone/.style={
        fill=green!10,
        draw=green!60,
        line width=1.5pt,
        dotted
    },

    % Quarantine zone style
    quarantine zone/.style={
        fill=yellow!15,
        draw=orange!70,
        line width=2pt,
        pattern=north west lines,
        pattern color=orange!20
    },

    % 3D-style node (raised appearance)
    raised 3d/.style={
        blur shadow={
            shadow blur steps=5,
            shadow xshift=3pt,
            shadow yshift=-3pt,
            shadow blur radius=2pt
        },
        postaction={
            draw=white,
            line width=1pt,
            shorten >=0.5pt,
            shorten <=0.5pt,
            transform canvas={shift={(0.5pt,0.5pt)}}
        }
    }
}

% ============================================================================
% ADVANCED NODE SHAPE LIBRARY
% ============================================================================

\tikzset{
    % Database cluster (multiple cylinders)
    database cluster/.style={
        cylinder,
        shape border rotate=90,
        minimum width=1.2cm,
        minimum height=1.5cm,
        fill=serverBlue!30,
        draw=serverBlue!80,
        line width=1.5pt,
        aspect=0.3,
        double border=serverBlue
    },

    % Load balancer (diamond with special marking)
    load balancer node/.style={
        diamond,
        minimum width=2cm,
        minimum height=2cm,
        fill=routerOrange!25,
        draw=routerOrange!80,
        line width=1.5pt,
        glow
    },

    % Cloud service (with layers)
    cloud service/.style={
        cloud,
        cloud puffs=12,
        cloud puff arc=120,
        aspect=2,
        minimum width=3cm,
        minimum height=2cm,
        fill=cloudGray!25,
        draw=cloudGray!80,
        line width=1.5pt,
        shimmer=blue
    },

    % Container (rounded rectangle with lines)
    container node/.style={
        rectangle,
        rounded corners=5pt,
        minimum width=2cm,
        minimum height=1.5cm,
        fill=clientGreen!20,
        draw=clientGreen!70,
        line width=1pt,
        path picture={
            \draw[clientGreen!50]
                (path picture bounding box.north west) --
                (path picture bounding box.north east);
            \draw[clientGreen!50]
                ([yshift=-3mm]path picture bounding box.north west) --
                ([yshift=-3mm]path picture bounding box.north east);
        }
    },

    % Virtual machine (nested boxes)
    vm node/.style={
        rectangle,
        rounded corners=3pt,
        minimum width=2cm,
        minimum height=1.5cm,
        fill=serverBlue!15,
        draw=serverBlue!70,
        line width=1pt,
        double border=serverBlue
    },

    % IoT device (small hexagon)
    iot device/.style={
        regular polygon,
        regular polygon sides=6,
        minimum size=1.5cm,
        fill=purple!20,
        draw=purple!70,
        line width=1pt
    },

    % Mobile device (rounded rectangle - portrait)
    mobile device/.style={
        rectangle,
        rounded corners=3pt,
        minimum width=1cm,
        minimum height=1.8cm,
        fill=clientGreen!20,
        draw=clientGreen!70,
        line width=1pt,
        path picture={
            \fill[clientGreen!40]
                ([yshift=1mm]path picture bounding box.south)
                circle (1.5pt);
        }
    }
}

% ============================================================================
% AUTO-LEGEND GENERATION SYSTEM
% ============================================================================

% Counter for legend items
\newcounter{legendItemCount}
\setcounter{legendItemCount}{0}

% Store legend items
\newcommand{\legendItems}{}

% Add item to legend
% Usage: \addLegendItem{style}{label}
\newcommand{\addLegendItem}[2]{
    \stepcounter{legendItemCount}
    \expandafter\gdef\expandafter\legendItems\expandafter{%
        \legendItems
        \node[#1, minimum width=0.8cm, minimum height=0.4cm]
            at (0, -\value{legendItemCount}*0.6) {};
        \node[right, font=\tiny]
            at (0.5, -\value{legendItemCount}*0.6) {#2};
    }
}

% Render the legend
% Usage: \renderLegend{x}{y}{title}
\newcommand{\renderLegend}[3]{
    \begin{scope}[shift={(#1,#2)}]
        \node[font=\small\bfseries] at (1, 0.3) {#3};
        \draw[draw=black!30, fill=white, rounded corners=2pt]
            (-0.3, 0.7) rectangle (2.5, -\value{legendItemCount}*0.6 - 0.3);
        \legendItems
    \end{scope}
}

% Quick legend presets
\newcommand{\addStandardLegend}{
    \addLegendItem{server premium}{Server}
    \addLegendItem{client premium}{Client}
    \addLegendItem{router premium}{Router}
    \addLegendItem{firewall premium}{Firewall}
    \addLegendItem{switch premium}{Switch}
}

\newcommand{\addConnectionLegend}{
    \addLegendItem{normal conn}{Normal}
    \addLegendItem{encrypted conn}{Encrypted}
    \addLegendItem{suspicious conn}{Suspicious}
    \addLegendItem{attack conn}{Attack}
}

\newcommand{\addThreatLegend}{
    \draw[fill=threatCritical] (0, -1*0.6) circle(2pt);
    \node[right, font=\tiny] at (0.5, -1*0.6) {Critical};
    \draw[fill=threatHigh] (0, -2*0.6) circle(2pt);
    \node[right, font=\tiny] at (0.5, -2*0.6) {High};
    \draw[fill=threatMedium] (0, -3*0.6) circle(2pt);
    \node[right, font=\tiny] at (0.5, -3*0.6) {Medium};
    \draw[fill=threatLow] (0, -4*0.6) circle(2pt);
    \node[right, font=\tiny] at (0.5, -4*0.6) {Low};
}

% ============================================================================
% SMART POSITIONING HELPERS
% ============================================================================

% Calculate positions for grid layout
% Usage: \gridPosition{row}{col}{spacing}
\newcommand{\gridPosition}[3]{
    (#2*#3, -#1*#3)
}

% Calculate positions for circular layout
% Usage: \circularPosition{index}{total}{radius}
\newcommand{\circularPosition}[3]{
    ({#3*cos(360/#2*#1)}, {#3*sin(360/#2*#1)})
}

% Create a row of nodes
% Usage: \nodeRow{base-name}{y}{count}{spacing}{style}{label-prefix}
\newcommand{\nodeRow}[6]{
    \foreach \i in {1,...,#3} {
        \node[#5] (#1-\i) at ({(\i-1)*#4}, #2) {#6 \i};
    }
}

% Create a column of nodes
% Usage: \nodeColumn{base-name}{x}{count}{spacing}{style}{label-prefix}
\newcommand{\nodeColumn}[6]{
    \foreach \i in {1,...,#3} {
        \node[#5] (#1-\i) at (#2, {-(\i-1)*#4}) {#6 \i};
    }
}

% Create a grid of nodes
% Usage: \nodeGrid{base-name}{rows}{cols}{spacing}{style}
\newcommand{\nodeGrid}[5]{
    \foreach \row in {1,...,#2} {
        \foreach \col in {1,...,#3} {
            \pgfmathtruncatemacro{\nodenum}{(\row-1)*#3+\col}
            \node[#5] (#1-\nodenum) at \gridPosition{\row}{\col}{#4} {\nodenum};
        }
    }
}

% ============================================================================
% ENHANCED BADGE POSITIONING
% ============================================================================

% Multi-badge support (stack badges)
\newcommand{\stackBadges}[4]{
    % #1 = node, #2 = position, #3 = badge1, #4 = badge2
    \nodeBadge{#1}{#3}{#2}{1}
    \pgfmathparse{equal("#2","north east") || equal("#2","north west") ? 1 : -1}
    \let\direction\pgfmathresult
    \node[#4, badge #2, yshift=\direction*0.7cm] at (#1.#2) {2};
}

% Badge with custom icon/text
\newcommand{\customBadge}[4]{
    % #1 = node, #2 = position, #3 = color, #4 = text
    \node[base badge, fill=#3!70, text=white, draw=#3!90, badge #2] at (#1.#2) {#4};
}

% Numeric indicator badge (for counts, versions, etc.)
\newcommand{\numericBadge}[4]{
    % #1 = node, #2 = position, #3 = number, #4 = color
    \node[base badge, fill=#4!70, text=white, draw=#4!90, badge #2, font=\tiny\bfseries]
        at (#1.#2) {#3};
}

% ============================================================================
% QUALITY OF LIFE IMPROVEMENTS
% ============================================================================

% Quick diagram setup
\newcommand{\setupDiagram}[1]{
    % #1 = preset name (corporate, security, presentation, accessible, dark)
    \ifthenelse{\equal{#1}{corporate}}{\loadCorporatePreset}{}
    \ifthenelse{\equal{#1}{security}}{\loadSecurityPreset}{}
    \ifthenelse{\equal{#1}{presentation}}{\loadPresentationPreset}{}
    \ifthenelse{\equal{#1}{accessible}}{\loadAccessiblePreset}{}
    \ifthenelse{\equal{#1}{dark}}{\loadDarkPreset}{}
}

% Quick three-tier architecture
% Usage: \threeTierSetup{x-offset}{y-spacing}
\newcommand{\threeTierSetup}[2]{
    % Web tier
    \nodeRow{web}{0}{3}{#1}{server premium}{Web-}
    % App tier
    \nodeRow{app}{-#2}{3}{#1}{server premium}{App-}
    % DB tier
    \nodeRow{db}{-2*#2}{2}{#1}{database cluster}{DB-}

    % Connections
    \foreach \i in {1,2,3} {
        \draw[encrypted conn] (web-\i) -- (app-\i);
    }
    \foreach \i in {1,2,3} {
        \pgfmathtruncatemacro{\dbnode}{(\i < 3) ? \i : 2}
        \draw[encrypted conn] (app-\i) -- (db-\dbnode);
    }
}

% Default styling improvements
\tikzset{
    % Smart defaults for all nodes
    every node/.append style={
        font=\sffamily
    },

    % Smart defaults for connections
    every path/.append style={
        -{Stealth[length=3mm]}
    }
}

% ============================================================================
% DIAGRAM TEMPLATES
% ============================================================================

% Template: DMZ Architecture
\newcommand{\dmzTemplate}{
    % Public zone
    \node[cloud premium] (internet) at (0,4) {Internet};
    \node[firewall premium] (fw-edge) at (0,2) {Edge Firewall};

    % DMZ
    \quickServer{dmz-web}{-2,0}{Web Server}
    \quickServer{dmz-api}{2,0}{API Server}

    % Internal firewall
    \node[firewall premium] (fw-int) at (0,-2) {Internal Firewall};

    % Internal zone
    \quickServer{int-app}{-2,-4}{App Server}
    \node[database cluster] (int-db) at (2,-4) {Database};

    % Connections
    \draw[normal conn] (internet) -- (fw-edge);
    \draw[encrypted conn] (fw-edge) -- (dmz-web);
    \draw[encrypted conn] (fw-edge) -- (dmz-api);
    \draw[encrypted conn] (dmz-web) -- (fw-int);
    \draw[encrypted conn] (dmz-api) -- (fw-int);
    \draw[encrypted conn] (fw-int) -- (int-app);
    \draw[encrypted conn] (int-app) -- (int-db);

    % Badges
    \addBadges{dmz-web}{linux badge}{online badge}
    \addBadges{dmz-api}{linux badge}{online badge}
    \addBadges{int-app}{linux badge}{online badge}
}

% Color scheme cycling for multi-diagram documents
\newcounter{diagramColorCycle}
\newcommand{\nextColorScheme}{
    \stepcounter{diagramColorCycle}
    \pgfmathparse{mod(\value{diagramColorCycle},6)}
    \let\schemeindex\pgfmathresult
    \ifnum\schemeindex=0 \loadColorScheme{standard}\fi
    \ifnum\schemeindex=1 \loadColorScheme{dark}\fi
    \ifnum\schemeindex=2 \loadColorScheme{colorblind}\fi
    \ifnum\schemeindex=3 \loadColorScheme{tritanopia}\fi
    \ifnum\schemeindex=4 \loadColorScheme{monochrome}\fi
    \ifnum\schemeindex=5 \loadColorScheme{high-contrast}\fi
}

% ============================================================================
% ADDITIONAL CONNECTION TYPES FOR ENTERPRISE FEATURES
% ============================================================================

\tikzset{
    % Database replication (thick with direction indicator)
    replication/.style={
        line width=2pt,
        draw=blue!60,
        -{Stealth[length=4mm]},
        postaction={
            decorate,
            decoration={
                markings,
                mark=between positions 0.2 and 0.8 step 0.2 with {
                    \node[fill=blue!40, rectangle, inner sep=1pt, font=\tiny] {R};
                }
            }
        }
    },

    % Heartbeat/keepalive connection (pulsing dots)
    heartbeat/.style={
        line width=1pt,
        draw=red!50,
        dashed,
        dash pattern=on 2pt off 2pt,
        postaction={
            decorate,
            decoration={
                markings,
                mark=between positions 0.1 and 0.9 step 0.2 with {
                    \node[fill=red!60, circle, inner sep=1.5pt] {};
                }
            }
        }
    },

    % Backup connection (thick gray with arrows)
    backup/.style={
        line width=2.5pt,
        draw=gray!60,
        -{Stealth[length=4mm]},
        postaction={
            decorate,
            decoration={
                markings,
                mark=between positions 0.3 and 0.7 step 0.2 with {
                    \node[fill=gray!40, rectangle, inner sep=1pt, font=\tiny] {B};
                }
            }
        }
    },

    % Sync connection (bidirectional with sync markers)
    sync/.style={
        line width=1.5pt,
        draw=green!60,
        {Stealth[length=3mm]}-{Stealth[length=3mm]},
        postaction={
            decorate,
            decoration={
                markings,
                mark=at position 0.5 with {
                    \node[fill=green!40, circle, inner sep=2pt, font=\tiny] {S};
                }
            }
        }
    },

    % API call (thin with small arrows)
    api call/.style={
        line width=1pt,
        draw=orange!60,
        -{Stealth[length=2mm]},
        postaction={
            decorate,
            decoration={
                markings,
                mark=between positions 0.2 and 0.8 step 0.3 with {
                    \node[fill=orange!30, rectangle, inner sep=0.5pt, font=\tiny] {API};
                }
            }
        }
    },

    % Message queue (wavy with envelope icons)
    message queue/.style={
        line width=1.5pt,
        draw=purple!60,
        decorate,
        decoration={
            snake,
            amplitude=0.5mm,
            segment length=8mm
        }
    },

    % Streaming data (fast flowing arrows)
    streaming/.style={
        line width=2pt,
        draw=cyan!70,
        -{Stealth[length=3mm]},
        postaction={
            decorate,
            decoration={
                markings,
                mark=between positions 0.1 and 0.9 step 0.1 with {
                    \draw[-{Stealth[length=1.5mm]}, cyan!70, line width=0.5pt] (0,0) -- (0.2,0);
                }
            }
        }
    }
}

% ============================================================================
% PERFORMANCE MONITORING VISUAL INDICATORS
% ============================================================================

\tikzset{
    % CPU utilization bar
    cpu bar/.style={
        rectangle,
        minimum width=2cm,
        minimum height=0.3cm,
        draw=black!50,
        fill=none,
        append after command={
            \pgfextra{
                \fill[green!60] (\tikzlastnode.south west) rectangle
                    ([xshift=#1*2cm]\tikzlastnode.south west |- \tikzlastnode.north west);
            }
        }
    },

    % Memory indicator
    memory indicator/.style={
        circle,
        minimum size=1cm,
        draw=blue!70,
        line width=2pt,
        fill=none,
        append after command={
            \pgfextra{
                \fill[blue!30] (\tikzlastnode.center) -- ++(0:#1*0.5cm)
                    arc (0:360*#1:0.5cm) -- cycle;
            }
        }
    },

    % Health status ring
    health ring/.style={
        circle,
        minimum size=0.8cm,
        line width=3pt,
        fill=none,
        draw=#1
    }
}

% Command to add performance indicator
% Usage: \performanceIndicator{node}{type}{value}{label}
\newcommand{\performanceIndicator}[4]{
    \node[#2=#3, below=0.3cm of #1, font=\tiny] {};
    \node[below=0.5cm of #1, font=\tiny] {#4: #3\%};
}

% ============================================================================
% ADVANCED ZONE GROUPING WITH LABELS
% ============================================================================

\tikzset{
    % Cloud zone (AWS/Azure/GCP style)
    cloud zone/.style={
        draw=blue!40,
        fill=blue!5,
        rounded corners=10pt,
        line width=2pt,
        dashed,
        dash pattern=on 8pt off 4pt
    },

    % Kubernetes namespace
    k8s namespace/.style={
        draw=cyan!50,
        fill=cyan!5,
        rounded corners=5pt,
        line width=1.5pt,
        pattern=horizontal lines,
        pattern color=cyan!10
    },

    % Physical datacenter
    datacenter zone/.style={
        draw=gray!60,
        fill=gray!5,
        line width=2pt,
        double distance=3pt
    },

    % Trust boundary
    trust boundary/.style={
        draw=red!60,
        fill=none,
        line width=3pt,
        dashed,
        dash pattern=on 10pt off 5pt,
        postaction={
            decorate,
            decoration={
                markings,
                mark=between positions 0.1 and 0.9 step 0.2 with {
                    \node[fill=red!70, text=white, font=\tiny\bfseries, inner sep=2pt] {!};
                }
            }
        }
    }
}

% Command to create labeled zone
% Usage: \labeledZone{style}{min-corner}{max-corner}{label}{position}
\newcommand{\labeledZone}[5]{
    \draw[#1] #2 rectangle #3;
    \node[anchor=#5, font=\small\bfseries, fill=white, inner sep=3pt]
        at #3 {#4};
}

% ============================================================================
% COMPLIANCE AND CERTIFICATION BADGES
% ============================================================================

\tikzset{
    % Compliance badges
    pci dss badge/.style={
        rectangle,
        rounded corners=2pt,
        fill=blue!70,
        text=white,
        font=\tiny\bfseries,
        inner sep=2pt,
        minimum width=1cm
    },

    hipaa badge/.style={
        rectangle,
        rounded corners=2pt,
        fill=green!70,
        text=white,
        font=\tiny\bfseries,
        inner sep=2pt,
        minimum width=1cm
    },

    sox badge/.style={
        rectangle,
        rounded corners=2pt,
        fill=purple!70,
        text=white,
        font=\tiny\bfseries,
        inner sep=2pt,
        minimum width=1cm
    },

    iso27001 badge/.style={
        rectangle,
        rounded corners=2pt,
        fill=orange!70,
        text=white,
        font=\tiny\bfseries,
        inner sep=2pt,
        minimum width=1cm
    },

    gdpr badge/.style={
        rectangle,
        rounded corners=2pt,
        fill=teal!70,
        text=white,
        font=\tiny\bfseries,
        inner sep=2pt,
        minimum width=1cm
    }
}

% Command to add compliance badge
% Usage: \complianceBadge{node}{type}{position}
\newcommand{\complianceBadge}[3]{
    \node[#2, below=0.2cm of #1] at (#1.south) {#2};
}

% ============================================================================
% THEME VARIATIONS (SUB-THEMES)
% ============================================================================

% Corporate Blue theme
\newcommand{\loadCorporateBlueTheme}{
    \loadColorScheme{standard}
    \tikzset{
        every node/.append style={font=\sffamily, fill opacity=0.9},
        server/.append style={fill=blue!20, draw=blue!80}
    }
}

% Hacker/Cyberpunk theme
\newcommand{\loadCyberpunkTheme}{
    \loadColorScheme{dark}
    \setTheme{dark}
    \tikzset{
        every node/.append style={neon=green, text=green!80},
        server/.append style={fill=black!80, draw=green!60, line width=2pt}
    }
}

% Minimal/Clean theme
\newcommand{\loadMinimalTheme}{
    \loadColorScheme{monochrome}
    \tikzset{
        every node/.append style={font=\sffamily, thin},
        server/.append style={fill=white, draw=black!40, line width=0.5pt}
    }
}

% Military/Government theme
\newcommand{\loadMilitaryTheme}{
    \loadColorScheme{high-contrast}
    \tikzset{
        every node/.append style={font=\sffamily\bfseries},
        server/.append style={fill=green!10, draw=green!80, line width=2pt, pattern=north east lines}
    }
}

% ============================================================================
% ADDITIONAL DIAGRAM TEMPLATES
% ============================================================================

% Template: Cloud Architecture (multi-cloud)
\newcommand{\cloudArchitectureTemplate}{
    % AWS Zone
    \labeledZone{cloud zone}{(-4,2)}{(-0.5,-2)}{AWS}{north east}
    \node[cloud service] (aws-lb) at (-2.5,0.5) {AWS LB};
    \node[server premium] (aws-ec2) at (-2.5,-0.5) {EC2};

    % Azure Zone
    \labeledZone{cloud zone}{(0.5,2)}{(4,-2)}{Azure}{north west}
    \node[cloud service] (azure-lb) at (2.5,0.5) {Azure LB};
    \node[server premium] (azure-vm) at (2.5,-0.5) {VM};

    % Connections
    \draw[sync] (aws-lb) -- (azure-lb);
    \draw[load balanced] (aws-lb) -- (aws-ec2);
    \draw[load balanced] (azure-lb) -- (azure-vm);
}

% Template: Microservices Architecture
\newcommand{\microservicesTemplate}{
    % API Gateway
    \node[load balancer node] (gateway) at (0,3) {API Gateway};

    % Microservices
    \node[container node] (auth) at (-4,0) {Auth\\Service};
    \node[container node] (user) at (-1,0) {User\\Service};
    \node[container node] (order) at (2,0) {Order\\Service};
    \node[container node] (payment) at (5,0) {Payment\\Service};

    % Message queue
    \node[rectangle, fill=purple!20, draw=purple!60, minimum width=6cm, minimum height=0.8cm]
        (mq) at (0.5,-2.5) {Message Queue};

    % Database
    \node[database cluster] (db) at (0.5,-5) {Shared DB};

    % Connections
    \foreach \service in {auth, user, order, payment} {
        \draw[api call] (gateway) -- (\service);
        \draw[message queue] (\service) -- (mq);
    }
    \draw[normal conn] (mq) -- (db);
}

% Template: Kubernetes Cluster
\newcommand{\kubernetesTemplate}{
    % Master nodes
    \nodeRow{master}{0}{3}{3}{server premium}{Master-}

    % Worker nodes
    \nodeRow{worker}{-3}{5}{2.5}{server premium}{Worker-}

    % etcd cluster
    \nodeRow{etcd}{-6}{3}{3}{database cluster}{etcd-}

    % Connections
    \foreach \i in {1,2,3} {
        \draw[heartbeat] (master-\i) -- (etcd-\i);
    }
    \foreach \m in {1,2,3} {
        \foreach \w in {1,2,3,4,5} {
            \draw[api call] (master-\m) -- (worker-\w);
        }
    }

    % Label zones
    \labeledZone{k8s namespace}{(-1.5,1)}{(7.5,-2)}{Control Plane}{north east}
    \labeledZone{k8s namespace}{(-1.5,-2.5)}{(11,-4)}{Workers}{north east}
    \labeledZone{k8s namespace}{(-1.5,-5)}{(7.5,-7)}{State Store}{north east}
}

% ============================================================================
% SMART AUTO-SIZING HELPERS
% ============================================================================

% Auto-calculate node spacing based on count
\newcommand{\autoSpacing}[1]{
    \pgfmathparse{max(2, 15/#1)}
    \pgfmathresult
}

% Auto-scale diagram based on node count
\newcommand{\autoScale}[1]{
    \pgfmathparse{min(1.5, max(0.5, 30/#1))}
    \pgfmathresult
}

% ============================================================================
% CONNECTION PATH QUALITY IMPROVEMENTS
% ============================================================================

\tikzset{
    % Smooth curved path
    smooth path/.style={
        rounded corners=5pt,
        -{Stealth[length=3mm]}
    },

    % Right-angle orthogonal path
    ortho path/.style={
        -{Stealth[length=3mm]},
        rounded corners=2pt
    },

    % Bezier curve path
    bezier path/.style={
        out=#1,
        in=#2,
        -{Stealth[length=3mm]}
    }
}

% Command for auto-routed connection (avoids overlaps)
% Usage: \autoConnection{from}{to}{style}{via-points}
\newcommand{\autoConnection}[4]{
    \draw[#3] (#1) #4 (#2);
}

% ============================================================================
% QUICK-START HELPER MACROS
% ============================================================================

% One-command network setup
% Usage: \quickNetwork{node-count}{style}
\newcommand{\quickNetwork}[2]{
    \pgfmathtruncatemacro{\rows}{ceil(sqrt(#1))}
    \pgfmathtruncatemacro{\cols}{ceil(#1/\rows)}
    \nodeGrid{node}{\rows}{\cols}{3}{#2}
}

% Instant server farm
% Usage: \serverFarm{count}{name-prefix}
\newcommand{\serverFarm}[2]{
    \nodeRow{#2}{0}{#1}{\autoSpacing{#1}}{server premium}{#2-}
    \node[load balancer node] (lb-#2) at ({\autoSpacing{#1}*(#1-1)/2}, 2) {Load Balancer};
    \foreach \i in {1,...,#1} {
        \draw[load balanced] (lb-#2) -- (#2-\i);
    }
}

% Instant database cluster with replication
% Usage: \dbClusterSetup{name-prefix}{count}
\newcommand{\dbClusterSetup}[2]{
    \node[database cluster] (#1-primary) at (0,0) {Primary};
    \foreach \i in {1,...,#2} {
        \node[database cluster] (#1-replica-\i) at ({\i*3},-2) {Replica \i};
        \draw[replication] (#1-primary) -- (#1-replica-\i);
    }
}

% ============================================================================
% EXPORT AND UTILITY FEATURES
% ============================================================================

% Generate diagram metadata
\newcommand{\diagramMetadata}[3]{
    \node[anchor=south west, font=\tiny, text=gray] at (current bounding box.south west) {
        Created: #1 | Version: #2 | Author: #3
    };
}

% Add watermark
\newcommand{\addWatermark}[1]{
    \node[anchor=center, font=\Huge, text=gray!20, rotate=45]
        at (current bounding box.center) {#1};
}

% Add timestamp
\newcommand{\addTimestamp}{
    \node[anchor=south east, font=\tiny, text=gray]
        at (current bounding box.south east) {\today};
}

% ============================================================================
% ACCESSIBILITY ENHANCEMENTS
% ============================================================================

% High visibility mode (extra thick borders, high contrast)
\newcommand{\enableHighVisibility}{
    \tikzset{
        every node/.append style={line width=3pt, font=\large\bfseries},
        every path/.append style={line width=3pt}
    }
}

% Text-only mode (for screen readers - adds labels)
\newcommand{\enableTextMode}{
    \tikzset{
        every node/.append style={
            label={[font=\tiny, text=black]:{\tikz@node@name}}
        }
    }
}

% Print optimization (removes gradients, uses patterns)
\newcommand{\optimizeForPrint}{
    \loadColorScheme{monochrome}
    \tikzset{
        server/.append style={server colorblind},
        client/.append style={client colorblind}
    }
}
